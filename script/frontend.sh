#!/bin/bash

DIR="/usr/share/nginx/html"

echo "--------------------------------------------------------------------------------------------------------"
echo -e "\e[1;35m [INFO] Installing Nginx\e[0m"
echo "--------------------------------------------------------------------------------------------------------"

yum install nginx -y
if [ $?  -ne 0 ]; then
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;31m [ERROR] Nginx Installation has failed\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
    exit 2
else 
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;32m [SUCCESS] Nginx Installation Successful\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
fi


echo "--------------------------------------------------------------------------------------------------------"
echo -e "\e[1;35m [INFO] Downloading frontend file into tmp directory\e[0m"
echo "--------------------------------------------------------------------------------------------------------"


curl -s -L -o /tmp/frontend.zip "https://github.com/roboshop-devops-project/frontend/archive/main.zip"
if [ $?  -ne 0 ]; then
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;31m [ERROR] Download has failed\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
    exit 2
else 
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;32m [SUCCESS] Download is Successful\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
fi

echo "--------------------------------------------------------------------------------------------------------"
echo -e "\e[1;35m [INFO] Changing Directory \e[0m"
echo "--------------------------------------------------------------------------------------------------------"

cd $DIR
if [ -d "$DIR" ]; then
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;32m [SUCCESS] Directory Changed\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
else
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;31m [ERROR] Cant find the /usr/share/nginx/html directory\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
    exit 2
fi

echo "--------------------------------------------------------------------------------------------------------"
echo -e "\e[1;35m [INFO] Deleting all in the /usr/share/nginx/html \e[0m"
echo "--------------------------------------------------------------------------------------------------------"

rm -rf * 
if [ "$(ls -A $DIR)" ]; then
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;32m [ERROR] Take action $DIR is not Empty\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
    exit 2
else
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;31m [SUCCESS] $DIR is empty\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
fi

echo "--------------------------------------------------------------------------------------------------------"
echo -e "\e[1;35m [SUCCESS] Deleting all in the /usr/share/nginx/html \e[0m"
echo "--------------------------------------------------------------------------------------------------------"

unzip /tmp/frontend.zip 
if [ $?  -ne 0 ]; then
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;32m [ERROR] Please Check that /tmp/frontend.zip unable to unzip\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
    exit 2
else
    echo "--------------------------------------------------------------------------------------------------------"
    echo -e "\e[1;31m [SUCCESS] Files Unzipped\e[0m"
    echo "--------------------------------------------------------------------------------------------------------"
fi

mv frontend-main/* .
mv static/* .
rm -rf frontend-master README.md
mv localhost.conf /etc/nginx/default.d/roboshop.conf

systemctl enable nginx 
systemctl start nginx 

systemctl restart nginx